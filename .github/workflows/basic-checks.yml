name: Basic Checks

on:
  push:
    branches: ['**']
  pull_request:

env:
  CARGO_TERM_COLOR: always
  DATABASE_URL: "postgres://user:pass@localhost:5432/db" # Dummy URL for sqlx prepare check

jobs:
  fast-validation:
    name: Fast Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with:
          toolchain: 1.92.0
          components: rustfmt, clippy

      # 1. Format (Fastest)
      - name: Check Formatting
        run: cargo fmt --check

      # 2. Dependency Caching (Speed up)
      - name: Rust Cache
        uses: Swatinem/rust-cache@v2

      # 3. Clippy (Semantics)
      - name: Clippy
        run: cargo clippy -- -D warnings

      # 4. Test Compilation (Catches E0308 types instantly)
      # We use --no-run to just check if tests compile
      - name: Check Test Compilation
        run: cargo test --workspace --no-run

      # 5. Run Unit Tests (Basic Logic)
      - name: Run Unit Tests
        run: cargo test --workspace
