    Finished `dev` profile [unoptimized] target(s) in 0.52s
     Running `target/debug/zero_x_infinity --gateway`
[2m2025-12-28T05:43:47.110299Z[0m [32m INFO[0m Starting 0xInfinity Engine in dev mode
=== 0xInfinity: Chapter 9a - Gateway Mode ===
Loaded 3 assets from fixtures/assets_config.csv
Loaded 2 symbols from fixtures/symbols_config.csv
Active symbol: BTC_USDT (base=BTC, quote=USDT)
  Internal decimals: base=8
  Max tradeable @ $100000: 18446.74 BTC per order (u64 safe)
Gateway will listen on 0.0.0.0:8080
Active symbol: BTC_USDT
Order queue size: 10000

[Persistence] Connecting to TDengine...
[2m2025-12-28T05:43:47.121549Z[0m [32m INFO[0m Connected to TDengine: taos+ws://root:taosdata@localhost:6041
[2m2025-12-28T05:43:47.121678Z[0m [32m INFO[0m Initializing TDengine schema...
[2m2025-12-28T05:43:47.124080Z[0m [34mDEBUG[0m handshake request
GET /ws HTTP/1.1
Host: localhost:6041
Upgrade: websocket
Connection: Upgrade
Sec-Websocket-Key: s2BhenohSlgQD3qpgjKP0g==
Sec-WebSocket-Version: 13
Accept-Encoding: gzip


[2m2025-12-28T05:43:47.127428Z[0m [34mDEBUG[0m protocol handshake complete
[2m2025-12-28T05:43:47.127475Z[0m [34mDEBUG[0m handshake response Response { status: 101, version: HTTP/1.1, headers: {"upgrade": "websocket", "connection": "Upgrade", "sec-websocket-accept": "3tlXzI675lyD/bBc9QspQy4wRlI="}, body: () }
[2m2025-12-28T05:43:47.127543Z[0m [34mDEBUG[0m use deflate config: None
[2m2025-12-28T05:43:47.142198Z[0m [32m INFO[0m âœ… TDengine database precision: us (correct)
[2m2025-12-28T05:43:47.147572Z[0m [32m INFO[0m TDengine schema initialized successfully
âœ… TDengine connected and schema initialized
[2m2025-12-28T05:43:47.147593Z[0m [32m INFO[0m Creating K-Line streams...
[2m2025-12-28T05:43:47.149871Z[0m [32m INFO[0m Created stream: kline_1m_stream
[2m2025-12-28T05:43:47.151834Z[0m [32m INFO[0m Created stream: kline_5m_stream
[2m2025-12-28T05:43:47.152892Z[0m [32m INFO[0m Created stream: kline_15m_stream
[2m2025-12-28T05:43:47.154086Z[0m [32m INFO[0m Created stream: kline_30m_stream
[2m2025-12-28T05:43:47.155780Z[0m [32m INFO[0m Created stream: kline_1h_stream
[2m2025-12-28T05:43:47.156686Z[0m [32m INFO[0m Created stream: kline_1d_stream
[2m2025-12-28T05:43:47.156700Z[0m [32m INFO[0m K-Line streams setup complete
âœ… K-Line streams created
[2m2025-12-28T05:43:47.156715Z[0m [32m INFO[0m Pre-creating subtables for 2 symbols...
[2m2025-12-28T05:43:47.168099Z[0m [34mDEBUG[0m Pre-created subtables for symbol_id=0
[2m2025-12-28T05:43:47.169832Z[0m [34mDEBUG[0m Pre-created subtables for symbol_id=1
[2m2025-12-28T05:43:47.169848Z[0m [32m INFO[0m All symbol subtables pre-creation finished
âœ… Symbol subtables pre-created

[Account] Connecting to PostgreSQL...
[2m2025-12-28T05:43:47.180167Z[0m [32m INFO[0m PostgreSQL connection pool established
âœ… PostgreSQL connected
[2m2025-12-28T05:43:47.184232Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT asset_id, asset, name, â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT asset_id, asset, name, decimals, status, asset_flags \n               FROM assets_tb WHERE status = 1\n" [3mrows_affected[0m[2m=[0m3 [3mrows_returned[0m[2m=[0m3 [3melapsed[0m[2m=[0m3.689375ms [3melapsed_secs[0m[2m=[0m0.003689375
âœ… Loaded 3 assets
[2m2025-12-28T05:43:47.191826Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT symbol_id, symbol, base_asset_id, â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT symbol_id, symbol, base_asset_id, quote_asset_id,\n                      price_decimals, qty_decimals, min_qty, status, symbol_flags,\n                      base_maker_fee, base_taker_fee\n               FROM symbols_tb WHERE status = 1\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m1.13575ms [3melapsed_secs[0m[2m=[0m0.00113575
âœ… Loaded 1 symbols
ðŸ”„ TransferChannel created (buffer=1024)

[1] Initializing Trading Core...
Loaded balances for 1002 accounts (row-based format)
[2m2025-12-28T05:43:47.194114Z[0m [32m INFO[0m [UBSCore] Persistence enabled: data_dir=./data/ubscore
[2m2025-12-28T05:43:47.194160Z[0m [32m INFO[0m No snapshot found, cold start
[2m2025-12-28T05:43:47.194185Z[0m [32m INFO[0m Replayed WAL [3mfrom_seq[0m[2m=[0m1 [3mto_seq[0m[2m=[0m0

[Persistence] Pre-creating 2004 balance tables...
   Progress: 500/2004 tables...
   Progress: 1000/2004 tables...
   Progress: 1500/2004 tables...
   Progress: 2000/2004 tables...
âœ… Balance tables pre-created for 1002 users
ðŸš€ Gateway thread started
ðŸ“Š DepthService started
ðŸ“¡ WebSocket push service started
  â†’ TradingAdapter connected to UBSCore via TransferChannel
ðŸ”„ Transfer FSM coordinator initialized
[2m2025-12-28T05:43:47.609850Z[0m [32m INFO[0m [WsService] Started - polling push_event_queue
âœ… Trading Core initialized

ðŸŽ¯ System ready! Send orders to http://localhost:8080/api/v1/private/order
Press Ctrl+C to shutdown

[2m2025-12-28T05:43:47.610179Z[0m [32m INFO[0m [TRACE] Starting Multi-Thread Pipeline with 0 orders...
[2m2025-12-28T05:43:47.610218Z[0m [32m INFO[0m [ME] Persistence enabled: dir=./data/matching, snapshot_interval=1000
[2m2025-12-28T05:43:47.610257Z[0m [32m INFO[0m No snapshot found, cold start with empty OrderBook
[2m2025-12-28T05:43:47.610266Z[0m [32m INFO[0m MatchingService recovery complete: next_seq_id=1
[2m2025-12-28T05:43:47.610340Z[0m [32m INFO[0m ME Synchronization starting [3mfrom_seq[0m[2m=[0m1
[2m2025-12-28T05:43:47.610371Z[0m [32m INFO[0m ME Synchronization complete
[2m2025-12-28T05:43:47.610378Z[0m [32m INFO[0m [Settlement] Persistence enabled: dir=./data/settlement, checkpoint_interval=1000, snapshot_interval=10000
[2m2025-12-28T05:43:47.610399Z[0m [32m INFO[0m Settlement cold start: no snapshot found
[2m2025-12-28T05:43:47.610425Z[0m [34mDEBUG[0m WAL is empty
[2m2025-12-28T05:43:47.610432Z[0m [32m INFO[0m Settlement recovery complete [3mlast_trade_id[0m[2m=[0m0 [3mis_cold_start[0m[2m=[0mtrue
[2m2025-12-28T05:43:47.610437Z[0m [32m INFO[0m SettlementService recovery complete [3mlast_trade_id[0m[2m=[0m0 [3mis_cold_start[0m[2m=[0mtrue
[2m2025-12-28T05:43:47.610456Z[0m [32m INFO[0m Settlement Synchronization starting [3mlast_trade_id[0m[2m=[0m0
[2m2025-12-28T05:43:47.610474Z[0m [32m INFO[0m Settlement Synchronization complete
[2m2025-12-28T05:43:47.610532Z[0m [32m INFO[0m [TRACE] UBSCoreService thread started
[2m2025-12-28T05:43:47.610549Z[0m [32m INFO[0m [TRACE] Pipeline executing in CONTINUOUS mode (ctrl+c to stop)
ðŸš€ Gateway listening on http://0.0.0.0:8080
ðŸ“¡ WebSocket endpoint: ws://0.0.0.0:8080/ws
ðŸ“– API Docs: http://0.0.0.0:8080/docs
ðŸ“‚ Public API:  /api/v1/public/*
ðŸ”’ Private API: /api/v1/private/* (auth required)
[2m2025-12-28T05:43:51.655314Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"INSERT INTO users_tb (username, â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            INSERT INTO users_tb (username, email, password_hash, salt)\n            VALUES ($1, $2, $3, $4)\n            RETURNING user_id\n            \n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m6.800417ms [3melapsed_secs[0m[2m=[0m0.006800417
[2m2025-12-28T05:43:51.658889Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT user_id, username, email, â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            SELECT user_id, username, email, password_hash\n            FROM users_tb\n            WHERE email = $1\n            \n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m1.394333ms [3melapsed_secs[0m[2m=[0m0.001394333
[2m2025-12-28T05:43:51.681859Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT address FROM user_addresses â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT address FROM user_addresses WHERE user_id = $1 AND asset = $2 AND network = $3\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m3.332542ms [3melapsed_secs[0m[2m=[0m0.003332542
[2m2025-12-28T05:43:51.683860Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"INSERT INTO user_addresses (user_id, â€¦" [3mdb.statement[0m[2m=[0m"\n\nINSERT INTO user_addresses (user_id, asset, network, address) VALUES ($1, $2, $3, $4) ON CONFLICT DO NOTHING\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m1.622125ms [3melapsed_secs[0m[2m=[0m0.001622125
[2m2025-12-28T05:43:51.684540Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT address FROM user_addresses â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT address FROM user_addresses WHERE user_id = $1 AND asset = $2 AND network = $3\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m347.083Âµs [3melapsed_secs[0m[2m=[0m0.000347083
[2m2025-12-28T05:43:51.687260Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT 1 FROM deposit_history â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT 1 FROM deposit_history WHERE tx_hash = $1\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m645.125Âµs [3melapsed_secs[0m[2m=[0m0.000645125
[2m2025-12-28T05:43:51.687906Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT asset_id, asset, name, â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT asset_id, asset, name, decimals, status, asset_flags \n               FROM assets_tb WHERE asset = $1\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m424.375Âµs [3melapsed_secs[0m[2m=[0m0.000424375
[2m2025-12-28T05:43:51.688517Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"INSERT INTO deposit_history (tx_hash, â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            INSERT INTO deposit_history (tx_hash, user_id, asset, amount, status, block_height)\n            VALUES ($1, $2, $3, $4, 'SUCCESS', 100)\n            \n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m566.375Âµs [3melapsed_secs[0m[2m=[0m0.000566375
[2m2025-12-28T05:43:51.690855Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"INSERT INTO balances_tb (user_id, â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            INSERT INTO balances_tb (user_id, asset_id, account_type, available, frozen, version)\n            VALUES ($1, $2, 1, $3, 0, 1)\n            ON CONFLICT (user_id, asset_id, account_type) \n            DO UPDATE SET available = balances_tb.available + EXCLUDED.available, version = balances_tb.version + 1\n            \n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m2.280708ms [3melapsed_secs[0m[2m=[0m0.002280708
[2m2025-12-28T05:43:51.691324Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"COMMIT" [3mdb.statement[0m[2m=[0m"" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m415.417Âµs [3melapsed_secs[0m[2m=[0m0.000415417
[2m2025-12-28T05:43:51.696735Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"INSERT INTO api_keys_tb (user_id, â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            INSERT INTO api_keys_tb (user_id, api_key, key_type, key_data, label, permissions)\n            VALUES ($1, $2, 1, $3, $4, 15)\n            \n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m1.794958ms [3melapsed_secs[0m[2m=[0m0.001794958
[2m2025-12-28T05:43:51.699493Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT asset_id, asset, name, â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT asset_id, asset, name, decimals, status, asset_flags \n               FROM assets_tb WHERE asset = $1\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m284.708Âµs [3melapsed_secs[0m[2m=[0m0.000284708
[2m2025-12-28T05:43:51.700196Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT available, version FROM â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT available, version FROM balances_tb WHERE user_id = $1 AND asset_id = $2 AND account_type = 1 FOR UPDATE\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m655.25Âµs [3melapsed_secs[0m[2m=[0m0.00065525
[2m2025-12-28T05:43:51.701038Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"UPDATE balances_tb SET available â€¦" [3mdb.statement[0m[2m=[0m"\n\nUPDATE balances_tb SET available = available - $1, version = version + 1 WHERE user_id = $2 AND asset_id = $3 AND account_type = 1\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m768.208Âµs [3melapsed_secs[0m[2m=[0m0.000768208
[2m2025-12-28T05:43:51.702301Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"INSERT INTO withdraw_history (request_id, â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            INSERT INTO withdraw_history (request_id, user_id, asset, amount, fee, to_address, status)\n            VALUES ($1, $2, $3, $4, $5, $6, 'PROCESSING')\n            \n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m1.1995ms [3melapsed_secs[0m[2m=[0m0.0011995
[2m2025-12-28T05:43:51.702782Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"COMMIT" [3mdb.statement[0m[2m=[0m"" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m448.083Âµs [3melapsed_secs[0m[2m=[0m0.000448083
[2m2025-12-28T05:43:51.703936Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"UPDATE withdraw_history SET status â€¦" [3mdb.statement[0m[2m=[0m"\n\nUPDATE withdraw_history SET status = 'SUCCESS', tx_hash = $1, updated_at = CURRENT_TIMESTAMP WHERE request_id = $2\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m832Âµs [3melapsed_secs[0m[2m=[0m0.000832
[2m2025-12-28T05:43:51.709704Z[0m [34mDEBUG[0m [3msummary[0m[2m=[0m"SELECT 1 FROM deposit_history â€¦" [3mdb.statement[0m[2m=[0m"\n\nSELECT 1 FROM deposit_history WHERE tx_hash = $1\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m1 [3melapsed[0m[2m=[0m3.654292ms [3melapsed_secs[0m[2m=[0m0.003654292
