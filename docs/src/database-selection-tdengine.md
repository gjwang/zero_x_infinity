# æ•°æ®åº“é€‰å‹åˆ†æ: TDengine vs å…¶ä»–æ–¹æ¡ˆ

> **åœºæ™¯**: äº¤æ˜“æ‰€ Settlement Persistence - å­˜å‚¨è®¢å•ã€æˆäº¤ã€ä½™é¢

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### å€™é€‰æ•°æ®åº“

| æ•°æ®åº“ | ç±»å‹ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|
| **TDengine** | æ—¶åºæ•°æ®åº“ | IoT, é‡‘èæ•°æ®, é«˜é¢‘å†™å…¥ |
| PostgreSQL | å…³ç³»å‹æ•°æ®åº“ | é€šç”¨ OLTP |
| TimescaleDB | PostgreSQLæ‰©å±• | æ—¶åºæ•°æ® (åŸºäºPG) |
| ClickHouse | åˆ—å¼åˆ†ææ•°æ®åº“ | OLAP, å¤§è§„æ¨¡èšåˆ |
| Redis | å†…å­˜æ•°æ®åº“ | ç¼“å­˜, å®æ—¶çŠ¶æ€ |

---

## ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹© TDengine

### 1. æ€§èƒ½ä¼˜åŠ¿ (åŸºäº TSBS åŸºå‡†æµ‹è¯•)

| æŒ‡æ ‡ | TDengine vs TimescaleDB | TDengine vs PostgreSQL |
|------|-------------------------|------------------------|
| **å†™å…¥é€Ÿåº¦** | 1.5-6.7x æ›´å¿« | 10x+ æ›´å¿« |
| **æŸ¥è¯¢é€Ÿåº¦** | 1.2-24.6x æ›´å¿« | 10x+ æ›´å¿« |
| **å­˜å‚¨ç©ºé—´** | 1/12 - 1/27 | æå¤§èŠ‚çœ |

### 2. äº¤æ˜“æ‰€åœºæ™¯å®Œç¾åŒ¹é…

| éœ€æ±‚ | TDengine è§£å†³æ–¹æ¡ˆ |
|------|-------------------|
| **é«˜é¢‘å†™å…¥** | ç™¾ä¸‡/ç§’çº§å†™å…¥èƒ½åŠ› |
| **æ—¶é—´æˆ³ç´¢å¼•** | åŸç”Ÿæ—¶åºè®¾è®¡ï¼Œæ¯«ç§’çº§æŸ¥è¯¢ |
| **é«˜åŸºæ•°æ”¯æŒ** | äº¿çº§æ•°æ®ç‚¹ï¼ŒSuper Table |
| **å®æ—¶åˆ†æ** | å†…ç½®æµè®¡ç®—å¼•æ“ |
| **æ•°æ®è®¢é˜…** | ç±» Kafka çš„å®æ—¶æ¨é€ |
| **è‡ªåŠ¨åˆ†åŒº** | æŒ‰æ—¶é—´è‡ªåŠ¨åˆ†ç‰‡ |
| **é«˜å‹ç¼©ç‡** | 1/10 å­˜å‚¨ç©ºé—´ |

### 3. ç®€åŒ–æ¶æ„

```
ä¼ ç»Ÿæ–¹æ¡ˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    Redis     â”‚     Kafka      â”‚
â”‚  (æŒä¹…åŒ–)   â”‚   (ç¼“å­˜)     â”‚   (æ¶ˆæ¯é˜Ÿåˆ—)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TDengine æ–¹æ¡ˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TDengine                    â”‚
â”‚   æŒä¹…åŒ– + ç¼“å­˜ + æµè®¡ç®— + æ•°æ®è®¢é˜…          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å‡å°‘ç»„ä»¶ = å‡å°‘è¿ç»´å¤æ‚åº¦ + å‡å°‘å»¶è¿Ÿ**

### 4. Rust ç”Ÿæ€æ”¯æŒ

```toml
# Cargo.toml
[dependencies]
taos = { version = "0.12", features = ["ws", "ws-rustls"] }
```

- âœ… å®˜æ–¹ Rust å®¢æˆ·ç«¯ `taos`
- âœ… å¼‚æ­¥æ”¯æŒ (tokio å…¼å®¹)
- âœ… è¿æ¥æ±  (r2d2)
- âœ… WebSocket è¿æ¥ (é€‚åˆäº‘éƒ¨ç½²)

---

## âŒ ä¸ºä»€ä¹ˆä¸é€‰å…¶ä»–æ–¹æ¡ˆ

### PostgreSQL
- âŒ é€šç”¨æ•°æ®åº“ï¼Œæ—¶åºæ€§èƒ½å·®
- âŒ é«˜é¢‘å†™å…¥ä¼šæˆä¸ºç“¶é¢ˆ
- âŒ éœ€è¦é¢å¤–ä¼˜åŒ– (åˆ†åŒºè¡¨ã€ç´¢å¼•è°ƒä¼˜)
- âŒ å­˜å‚¨ç©ºé—´æ¶ˆè€—å¤§

### TimescaleDB
- âš ï¸ åŸºäº PostgreSQLï¼Œç»§æ‰¿å…¶é™åˆ¶
- âš ï¸ æ¯” TDengine æ…¢ 1.5-6.7x
- âš ï¸ å­˜å‚¨ç©ºé—´æ˜¯ TDengine çš„ 12-27x
- âœ… å¦‚æœå·²æœ‰ PostgreSQL ç”Ÿæ€å¯è€ƒè™‘

### ClickHouse
- âœ… åˆ†ææŸ¥è¯¢æå¿«
- âŒ å®æ—¶å†™å…¥ä¸å¦‚ TDengine
- âŒ æ›´é€‚åˆæ‰¹é‡å¯¼å…¥ + OLAP
- âŒ è¿ç»´å¤æ‚åº¦é«˜

### Redis
- âœ… æå¿«çš„å†…å­˜è¯»å†™
- âŒ æŒä¹…åŒ–ä¸å¯é  (RDB/AOF)
- âŒ æ•°æ®é‡å—å†…å­˜é™åˆ¶
- âŒ ä¸é€‚åˆä½œä¸ºä¸»å­˜å‚¨
- âš ï¸ é€‚åˆä½œä¸ºçƒ­æ•°æ®ç¼“å­˜å±‚

---

## ğŸ“‹ äº¤æ˜“æ‰€æ•°æ®æ¨¡å‹è®¾è®¡

### TDengine Super Table è®¾è®¡

```sql
-- è®¢å•è¡¨ (Super Table)
CREATE STABLE orders (
    ts TIMESTAMP,           -- è®¢å•æ—¶é—´æˆ³ (ä¸»é”®)
    order_id BIGINT,
    user_id BIGINT,
    side TINYINT,           -- 0=BUY, 1=SELL
    order_type TINYINT,     -- 0=LIMIT, 1=MARKET
    price BIGINT,           -- ä»·æ ¼ (æ•´æ•°è¡¨ç¤º)
    qty BIGINT,             -- æ•°é‡ (æ•´æ•°è¡¨ç¤º)
    filled_qty BIGINT,
    status TINYINT          -- 0=NEW, 1=FILLED, 2=CANCELED
) TAGS (
    symbol_id INT           -- äº¤æ˜“å¯¹ ID
);

-- æˆäº¤è¡¨ (Super Table)
CREATE STABLE trades (
    ts TIMESTAMP,           -- æˆäº¤æ—¶é—´æˆ³
    trade_id BIGINT,
    order_id BIGINT,
    user_id BIGINT,
    side TINYINT,
    price BIGINT,
    qty BIGINT,
    fee BIGINT
) TAGS (
    symbol_id INT
);

-- ä½™é¢å¿«ç…§è¡¨ (Super Table)  
CREATE STABLE balances (
    ts TIMESTAMP,           -- å¿«ç…§æ—¶é—´
    avail BIGINT,           -- å¯ç”¨ä½™é¢
    frozen BIGINT,          -- å†»ç»“ä½™é¢
    version BIGINT          -- ç‰ˆæœ¬å·
) TAGS (
    user_id BIGINT,
    asset_id INT
);

-- æŸ¥è¯¢ç¤ºä¾‹
-- æŸ¥è¯¢ç”¨æˆ·æœ€æ–°ä½™é¢
SELECT LAST_ROW(avail, frozen, version) FROM balances 
WHERE user_id = 1001 AND asset_id = 1;

-- æŸ¥è¯¢ç”¨æˆ·è®¢å•å†å²
SELECT * FROM orders WHERE user_id = 1001 
ORDER BY ts DESC LIMIT 100;

-- æŸ¥è¯¢æˆäº¤å†å²
SELECT * FROM trades WHERE user_id = 1001
AND ts >= NOW() - INTERVAL 1 DAY;
```

### Super Table ä¼˜åŠ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Super Table: orders                       â”‚
â”‚  (ç»Ÿä¸€ schemaï¼Œè‡ªåŠ¨æŒ‰ symbol_id åˆ†è¡¨)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ orders_BTC_USDT â”‚ orders_ETH_USDT â”‚ orders_ETH_BTC ... â”‚
â”‚   (å­è¡¨ 1)      â”‚    (å­è¡¨ 2)     â”‚     (å­è¡¨ N)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- âœ… è‡ªåŠ¨æŒ‰ TAG åˆ†è¡¨
- âœ… æŸ¥è¯¢æ—¶è‡ªåŠ¨èšåˆ
- âœ… Schema ç»Ÿä¸€ç®¡ç†

---

## ğŸ—ï¸ æ¶æ„é›†æˆæ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Gateway (HTTP)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Order Queue        â”‚
                    â”‚   (Ring Buffer)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Trading Core                                â”‚
â”‚   Ingestion â†’ UBSCore â†’ ME â†’ Settlement                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  Order Events  â”‚  â”‚ Trade Events  â”‚  â”‚Balance Eventsâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚                  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      TDengine         â”‚
                    â”‚  orders | trades | bal â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æœ€ç»ˆæ¨è

**ä¸»å­˜å‚¨**: TDengine
- è®¢å•ã€æˆäº¤ã€ä½™é¢å†å²

**å¯é€‰**: Redis (çƒ­æ•°æ®ç¼“å­˜)
- ç”¨æˆ·å½“å‰ä½™é¢
- æ´»è·ƒè®¢å•ç¼“å­˜
- å‡å°‘ TDengine è¯»å‹åŠ›

## ğŸ“Š é¢„æœŸæ€§èƒ½

| æŒ‡æ ‡ | é¢„æœŸå€¼ |
|------|--------|
| å†™å…¥å»¶è¿Ÿ | < 1ms |
| æŸ¥è¯¢å»¶è¿Ÿ (æœ€æ–°ä½™é¢) | < 5ms |
| å†å²æŸ¥è¯¢ (100æ¡) | < 10ms |
| å­˜å‚¨å‹ç¼©ç‡ | 10:1 |
| æ”¯æŒ TPS | 100,000+ |

---

## ğŸ”— å‚è€ƒèµ„æ–™

- [TDengine å®˜ç½‘](https://tdengine.com/)
- [TDengine Rust Client (taos)](https://github.com/taosdata/taos-connector-rust)
- [TDengine vs TimescaleDB Benchmark](https://tdengine.com/tdengine-vs-timescaledb/)
