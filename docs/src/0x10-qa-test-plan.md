# 0x10.5 QA Test Plan: Backend Gaps

> **Reference**: [Backend Requirements](./0x10-backend-gaps.md)
> **Standard**: [Verification Workflow](../standards/verification-workflow.md)

This document defines the Acceptance Criteria and Test Cases for the Phase 0x10.5 Backend Gap Filling Features.

---

## 1. Test Scope

| Feature | Type | Priority | Description |
|---------|------|----------|-------------|
| **Public Trades** | REST | P0 | `GET /api/v1/public/trades` |
| **WS Ticker** | WebSocket | P1 | `market.ticker.{symbol}` (24h Rolling) |
| **WS Depth** | WebSocket | P1 | `market.depth.{symbol}` (Snapshot) |
| **WS Trades** | WebSocket | P0 | `market.trade.{symbol}` (Real-time) |

---

## 2. Test Cases

### 2.1 Public Trades API (REST)

**TC-API-001: Basic Fetch**
*   **Step**: call `GET /api/v1/public/trades?symbol=BTC_USDT&limit=5`
*   **Expect**: HTTP 200, Array of 5 trades.
*   **Validation**:
    *   `price`, `qty` format: String with correct decimals.
    *   `time`: valid millisecond timestamp.
    *   `is_buyer_maker`: boolean.

**TC-API-002: Symbol Filtering**
*   **Step**: call for `ETH_USDT` vs `BTC_USDT`.
*   **Expect**: Only returns trades for the requested symbol.

### 2.2 WebSocket Ticker

**TC-WS-001: Subscribe & Push**
*   **Action**: Connect WS, send `{"op": "subscribe", "args": ["market.ticker.BTC_USDT"]}`
*   **Expect**: Receive `24hTicker` events every 1000ms (approx).
*   **Data Check**:
    *   `c` (Current Price) matches last trade.
    *   `v` (Volume) > 0 if trades occurred.

### 2.3 WebSocket Trades

**TC-WS-002: Real-time Latency**
*   **Action**: Subscribe `market.trade.BTC_USDT`.
*   **Action**: Place & Fill a Limit Order via REST.
*   **Expect**: Receive `trade` event immediately (< 10ms) after match.
*   **Data Check**: Trade ID matches the one generated by matching engine.

### 2.4 WebSocket Depth

**TC-WS-003: Snapshot Consistency**
*   **Action**: Subscribe `market.depth.BTC_USDT`.
*   **Action**: Poll `GET /api/v1/public/depth`.
*   **Expect**: WS data matches REST snapshot data (allowing for small timing differences).

---

## 3. Verification Checklist (For QA)

- [ ] **Protocol Check**: WS JSON format follows existing standards?
- [ ] **Precision Check**: All prices/quantities are Strings?
- [ ] **Performance**: Ticker calculation does not block the main thread?
- [ ] **Stability**: WS connection stays alive for > 1 hour?

---
