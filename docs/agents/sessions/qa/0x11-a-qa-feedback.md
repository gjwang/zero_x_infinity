# QA Feedback: 0x11-a Real Chain Integration

**To**: Developer Team
**From**: QA Team (Agents A, B, C)
**Date**: 2025-12-28
**Status**: üî¥ **BLOCKED**

## üö® Critical Blocker (P0)

### DEF-001: Gateway Address Generation Incompatible with Regtest
**Component**: Gateway (`src/funding/chain_adapter.rs`)
**Impact**: **BLOCKING**. Unable to verify deposit lifecycle.

**Description**:
The Gateway's `MockBtcChain` adapter generates address strings that mimic Legacy Mainnet format (starting with `1...`). However, the Real Chain Integration environment uses a Bitcoin Core **Regtest** node (`bitcoind -regtest`).

**Evidence**:
1. Gateway Address: `1yzCvAhKyxmf9Bxsax7Gtzt9W1nZcgH` (Generated by Gateway)
2. Regtest RPC Error: `Invalid Bitcoin address: ...` (Returned by `bitcoind` when attempting `sendtoaddress`)

**Root Cause**:
The `mock_btc_chain` implementation was not updated to support Regtest address formats (`bcrt1...` or legacy addresses valid for the regtest network context) or to derive addresses from the actual node via RPC.

**Required Fix**:
Update `src/funding/chain_adapter.rs` to either:
1. Generate valid Regtest addresses (e.g. valid Base58 checksums for Regtest).
2. OR (Preferred): In `dev` mode, allow Gateway to call `bitcoind` RPC `getnewaddress` to generate real spendable addresses.

---

## ‚úÖ Verified Items

Despite the blocker, we successfully verified:
*   **Sentinel Service**: Correctly scans blocks, detects deposits (verified via Grey-box test with manual SQL injection), and persists cursor position.
*   **Security (Agent C)**:
    *   No SQL/RPC injection vulnerabilities found.
    *   Address poisoning/duplicate requests handled correctly.
    *   Internal API endpoints properly secured.

## ‚è≠Ô∏è Next Steps
1. **Developer**: Fix DEF-001 in `src/funding/chain_adapter.rs`.
2. **QA**: Re-run `scripts/tests/0x11a_real_chain/run_all_0x11a.sh` to verify full deposit lifecycle (Agent B tests).

---
*See `docs/src/qa/0x11a_real_chain/test_report.md` for full test log.*
